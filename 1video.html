<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Видео-Загадка №...</title>
    <style>
        /* Базовые стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none; /* Запрет выделения текста */
            -webkit-user-select: none; /* Для Safari */
            -moz-user-select: none; /* Для Firefox */
            -ms-user-select: none; /* Для IE/Edge */
        }

        body {
            font-family: Arial, sans-serif;
            
            /* 1. ФОН - замените на свою картинку */
            background: #000; /* Черный фон по умолчанию */
            /* background: url('your-image.jpg') center/cover no-repeat fixed; */
            
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden; /* Запрет прокрутки */
            position: relative;
        }

        /* Затемнение фона */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: -1;
        }

        /* Контейнер видео */
        .video-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* Соотношение сторон 16:9 */
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            background: #000;
        }

        /* Iframe с видео */
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            pointer-events: auto;
        }

        /* Оверлей с иконкой play */
        .play-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .play-overlay:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .play-overlay svg {
            width: 30px;
            height: 30px;
            margin-left: 5px; /* Смещение для треугольной иконки */
        }

        /* Скрываем оверлей после клика */
        .play-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Блокирующий слой для предотвращения взаимодействия с iframe */
        .iframe-blocker {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            display: none;
        }

        /* Блокировка правого клика */
        .context-menu-blocker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: none;
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .play-overlay {
                width: 70px;
                height: 70px;
            }
            
            .play-overlay svg {
                width: 25px;
                height: 25px;
            }
        }

        @media (max-width: 480px) {
            .play-overlay {
                width: 60px;
                height: 60px;
            }
            
            .play-overlay svg {
                width: 20px;
                height: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Блокировщик контекстного меню -->
    <div class="context-menu-blocker" id="contextBlocker"></div>
    
    <!-- Основной контейнер -->
    <div class="video-container">
        <div class="video-wrapper">
            <!-- Блокирующий слой -->
            <div class="iframe-blocker" id="iframeBlocker"></div>
            
            <!-- Оверлей для запуска -->
            <div class="play-overlay" id="playOverlay">
                <svg viewBox="0 0 24 24" fill="white">
                    <path d="M8 5v14l11-7z"/>
                </svg>
            </div>
            
            <!-- Iframe будет создан динамически -->
            <div id="videoPlaceholder"></div>
        </div>
    </div>

    <script>
        // ============================================
        // ЗАЩИТНЫЕ МЕХАНИЗМЫ
        // ============================================

        // 1. Блокировка правого клика
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            showContextMenuBlocker();
            return false;
        });

        // 2. Блокировка клавиш
        document.addEventListener('keydown', function(e) {
            // Блокировка F12, Ctrl+Shift+I, Ctrl+U и т.д.
            if (
                e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.shiftKey && e.key === 'J') ||
                (e.ctrlKey && e.key === 'U') ||
                (e.metaKey && e.altKey && e.key === 'I')
            ) {
                e.preventDefault();
                return false;
            }
        });

        // 3. Блокировка перетаскивания
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });

        // 4. Запрет выделения текста
        document.addEventListener('selectstart', function(e) {
            e.preventDefault();
            return false;
        });

        // 5. Блокировка просмотра исходного кода
        document.onkeydown = function(e) {
            if (e.ctrlKey && (e.key === 'u' || e.key === 'U')) {
                return false;
            }
        };

        // ============================================
        // ФУНКЦИИ ЗАЩИТЫ
        // ============================================

        // Временное отображение блокировщика контекстного меню
        function showContextMenuBlocker() {
            const blocker = document.getElementById('contextBlocker');
            blocker.style.display = 'block';
            setTimeout(() => {
                blocker.style.display = 'none';
            }, 500);
        }

        // ============================================
        // ЗАГРУЗКА ВИДЕО
        // ============================================

        // Параметры видео (закодированные)
        const videoConfig = {
            // Закодированные параметры видео
            // Можно менять на свои значения
            o: '169051052',  // ownerId
            i: '456239019',  // videoId
            h: 'a1b2c3d4e5'  // hash (примерный)
        };

        // Функция создания защищенного iframe
        function createProtectedIframe() {
            const placeholder = document.getElementById('videoPlaceholder');
            
            // Очищаем placeholder
            placeholder.innerHTML = '';
            
            // Создаем iframe с обфусцированным src
            const iframe = document.createElement('iframe');
            
            // Собираем URL с закодированными параметрами
            const videoUrl = `https://vk.com/video_ext.php?oid=-${videoConfig.o}&id=${videoConfig.i}&hash=${videoConfig.h}`;
            
            // Устанавливаем атрибуты
            iframe.setAttribute('src', videoUrl);
            iframe.setAttribute('frameborder', '0');
            iframe.setAttribute('allowfullscreen', '');
            iframe.setAttribute('allow', 'encrypted-media; picture-in-picture');
            
            // Стилизация
            iframe.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border: none;
            `;
            
            // Добавляем iframe в DOM
            placeholder.appendChild(iframe);
            
            // Запускаем защитные механизмы для iframe
            setupIframeProtection(iframe);
            
            return iframe;
        }

        // Настройка защиты для iframe
        function setupIframeProtection(iframe) {
            // Периодически проверяем и очищаем title iframe
            setInterval(() => {
                try {
                    iframe.title = 'Video Player';
                } catch(e) {
                    // Игнорируем ошибки доступа
                }
            }, 1000);
            
            // Блокируем некоторые события на iframe
            iframe.addEventListener('load', function() {
                try {
                    // Пытаемся скрыть элементы управления VK внутри iframe
                    // (это работает не всегда из-за политики CORS)
                    setTimeout(() => {
                        try {
                            // Очищаем историю навигации iframe
                            iframe.contentWindow.location.replace('about:blank');
                        } catch(e) {
                            // Игнорируем ошибки CORS
                        }
                    }, 100);
                } catch(e) {
                    // Игнорируем ошибки доступа
                }
            });
        }

        // ============================================
        // УПРАВЛЕНИЕ ВОСПРОИЗВЕДЕНИЕМ
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            const playOverlay = document.getElementById('playOverlay');
            const iframeBlocker = document.getElementById('iframeBlocker');
            
            // Создаем iframe только после клика
            playOverlay.addEventListener('click', function() {
                // Скрываем оверлей
                playOverlay.classList.add('hidden');
                
                // Создаем iframe с видео
                const iframe = createProtectedIframe();
                
                // Активируем блокировщик для iframe
                setTimeout(() => {
                    iframeBlocker.style.display = 'block';
                    
                    // Блокируем клики по iframe через 1 секунду
                    setTimeout(() => {
                        iframeBlocker.style.display = 'none';
                    }, 1000);
                }, 500);
            });
            
            // ============================================
            // ДОПОЛНИТЕЛЬНАЯ ЗАЩИТА
            // ============================================
            
            // Запрещаем открытие новых окон/вкладок
            window.open = function() {
                return null;
            };
            
            // Запрещаем изменение location
            Object.defineProperty(window, 'location', {
                value: {
                    replace: function() {},
                    assign: function() {},
                    href: 'about:blank'
                },
                writable: false
            });
            
            // Маскируем реальный URL видео в iframe
            const originalCreateElement = document.createElement;
            document.createElement = function(tagName) {
                const element = originalCreateElement.call(this, tagName);
                if (tagName.toLowerCase() === 'iframe') {
                    // Добавляем защиту для всех создаваемых iframe
                    setTimeout(() => {
                        if (element.src && element.src.includes('vk.com')) {
                            // Периодически меняем title
                            setInterval(() => {
                                element.title = 'Video Content';
                            }, 2000);
                        }
                    }, 100);
                }
                return element;
            };
        });

        // ============================================
        // ОБРАБОТКА ОШИБОК
        // ============================================

        // Перехватываем ошибки загрузки
        window.addEventListener('error', function(e) {
            // Подавляем вывод ошибок в консоль
            e.preventDefault();
            return true;
        }, true);

        // Перехватываем unhandled rejections
        window.addEventListener('unhandledrejection', function(e) {
            e.preventDefault();
            return true;
        });

        // ============================================
        // ФОН СТРАНИЦЫ
        // ============================================

        // Функция для установки фона (опционально)
        function setBackgroundImage(imageUrl) {
            document.body.style.background = `url('${imageUrl}') center/cover no-repeat fixed`;
        }
        
        // Загружаем фон из URL параметра (если нужно)
        function loadBackgroundFromURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const bgUrl = urlParams.get('bg');
                if (bgUrl) {
                    setBackgroundImage(bgUrl);
                }
            } catch(e) {
                // Игнорируем ошибки
            }
        }
        
        // Вызываем при загрузке
        loadBackgroundFromURL();
    </script>
</body>
</html>
